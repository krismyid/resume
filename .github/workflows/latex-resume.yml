name: Build and Release LaTeX Resume

on:
  push:
    branches:
      - main
    paths:
      - 'resume.tex'
      - '.github/workflows/latex-resume.yml'
  workflow_dispatch:  # Allow manual triggering

jobs:
  build-latex-resume:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
        
      - name: Setup LaTeX environment
        uses: xu-cheng/latex-action@v3
        with:
          root_file: resume.tex
          latexmk_use_xelatex: false
          latexmk_use_lualatex: false
          working_directory: .
          
      - name: Verify PDF generation
        run: |
          if [ -f "resume.pdf" ]; then
            echo "âœ… PDF generated successfully"
            ls -la resume.pdf
            echo "PDF size: $(du -h resume.pdf | cut -f1)"
          else
            echo "âŒ PDF generation failed"
            exit 1
          fi
          
      - name: Create Release
        id: create_release
        uses: softprops/action-gh-release@v1
        with:
          tag_name: resume-v${{ github.run_number }}
          name: Resume v${{ github.run_number }} - ${{ github.event.head_commit.message }}
          draft: false
          prerelease: false
          body: |
            ## LaTeX Resume PDF
            
            **Generated on:** ${{ github.event.head_commit.timestamp }}
            **Commit:** ${{ github.sha }}
            **Branch:** ${{ github.ref_name }}
            
            ### Changes in this version:
            ${{ github.event.head_commit.message }}
            
            ### What's included:
            - Professional ATS-compliant resume in PDF format
            - Optimized for DevOps Engineer and SRE positions
            - Clean, professional formatting
            
            ---
            
            *This PDF was automatically generated from LaTeX source on GitHub Actions.*
            
          files: |
            resume.pdf
            resume.tex
          
      - name: Success notification
        run: |
          echo "ğŸ‰ Resume successfully built and released!"
          echo "ğŸ“„ PDF: resume.pdf"
          echo "ğŸ·ï¸  Release tag: resume-v${{ github.run_number }}"
          echo "ğŸ“Š File size: $(du -h resume.pdf | cut -f1)"
          echo "ğŸ”— Check releases page for download links" 